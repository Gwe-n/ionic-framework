<!DOCTYPE html>
<html dir="ltr">

<head>
  <meta charset="UTF-8">
  <title>Navigation Guards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="../../../../../css/ionic.bundle.css" rel="stylesheet">
  <link href="../../../../../scripts/testing/styles.css" rel="stylesheet">
  <script src="../../../../../scripts/testing/scripts.js"></script>
  <script nomodule src="../../../../../dist/ionic/ionic.js"></script>
  <script type="module" src="../../../../../dist/ionic/ionic.esm.js"></script>  <script>

    class HomePage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <ion-header>
          <ion-toolbar>
            <ion-title>Home Page</ion-title>
          </ion-toolbar>
        </ion-header>
        <ion-content>
          <ion-list>
            <ion-list-header>Router.push</ion-list-header>
            <div class="ion-padding">
              <ion-button id="router-child">Go To Child Page</ion-button><br>
              <ion-button id="router-child2">Go To Child2 Page</ion-button><br>
            </div>

            <ion-list-header>ion-router-link</ion-list-header>
            <div class="ion-padding">
              <ion-router-link href="/child">
                <ion-button>Go To Child Page</ion-button><br>
              </ion-router-link>
              <ion-router-link href="/child2">
                <ion-button>Go To Child2 Page</ion-button><br>
              </ion-router-link>
            </div>

            <ion-list-header>href</ion-list-header>
            <div class="ion-padding">
              <ion-button href="/child">Go To Child Page</ion-button><br>
              <ion-button href="/child2">Go To Child2 Page</ion-button><br>
            </div>
          </ion-list>
        </ion-content>`;

        const childButton = this.querySelector('#router-child');
        const child2Button = this.querySelector('#router-child2');
        childButton.addEventListener('click', () => {
          const r = document.querySelector('ion-router');
          r.push('/child');
        });

        child2Button.addEventListener('click', () => {
          const r = document.querySelector('ion-router');
          r.push('/child2');
        });
      }
    }

    class ChildPage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <ion-header>
          <ion-toolbar>
            <ion-buttons>
              <ion-back-button default-href="/test"></ion-back-button>
            </ion-buttons>
            <ion-title>Child Page</ion-title>
          </ion-toolbar>
        </ion-header>
        <ion-content>
        </ion-content>`;
      }
    }

    class Child2Page extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <ion-header>
          <ion-toolbar>
            <ion-buttons>
              <ion-back-button default-href="/"></ion-back-button>
            </ion-buttons>
            <ion-title>Child2 Page</ion-title>
          </ion-toolbar>
        </ion-header>
        <ion-content>
        </ion-content>`;
      }
    }

    class TestPage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <ion-header>
          <ion-toolbar>
            <ion-buttons>
              <ion-back-button default-href="/child2"></ion-back-button>
            </ion-buttons>
            <ion-title>Test Page</ion-title>
          </ion-toolbar>
        </ion-header>
        <ion-content>
        </ion-content>`;
      }
    }

    customElements.define('home-page', HomePage);
    customElements.define('child-page', ChildPage);
    customElements.define('child2-page', Child2Page);
    customElements.define('test-page', TestPage);

  </script>
</head>

<body>

  <ion-app>

    <ion-router>
      <ion-route-redirect from="/" to="/home"></ion-route-redirect>
      <ion-route url="/home" component="home-page"></ion-route>
      <ion-route url="/test" component="test-page"></ion-route>
      <ion-route url="/child" component="child-page"></ion-route>
      <ion-route url="/child2" component="child2-page"></ion-route>
    </ion-router>

    <ion-nav></ion-nav>

    <script>
      const redirect = (to = '/test') => { return { redirect: to }};
      const returnFalse = () => false;
      const returnTrue = () => true;

      const page = document.querySelector('ion-route[component="child-page"]');
      page.beforeEnter = redirect;
      page.beforeLeave = returnFalse;

      const page2 = document.querySelector('ion-route[component="child2-page"]');
      page2.beforeEnter = returnTrue;
      page2.beforeLeave = () => {
       return new Promise((resolve, reject) => {
         setTimeout(() => {
           return resolve();
         }, 1000);
       })
      };
    </script>
  </ion-app>
</body>
</html>
